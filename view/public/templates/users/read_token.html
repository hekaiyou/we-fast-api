{% extends 'base.html' %}
{% block title %}登录{% endblock %}

{% block head %}
<style>
    body>main {
        display: flex;
        flex-direction: column;
        justify-content: center;
        min-height: calc(100vh - 7rem);
        padding: 1rem 0;
    }

    article {
        padding: 0;
        overflow: hidden;
    }

    article div {
        padding: 1rem;
    }

    @media (min-width: 576px) {
        body>main {
            padding: 1.25rem 0;
        }

        article div {
            padding: 1.25rem;
        }
    }

    @media (min-width: 768px) {
        body>main {
            padding: 1.5rem 0;
        }

        article div {
            padding: 1.5rem;
        }
    }

    @media (min-width: 992px) {
        body>main {
            padding: 1.75rem 0;
        }

        article div {
            padding: 1.75rem;
        }
    }

    @media (min-width: 1200px) {
        body>main {
            padding: 2rem 0;
        }

        article div {
            padding: 2rem;
        }
    }

    /* Hero Image */
    article div:nth-of-type(2) {
        display: none;
        background-color: #374956;
        background-image: url("{{ url_for('static', path='/image/token-background-image.jpg') }}");
        background-position: center;
        background-size: cover;
    }

    @media (min-width: 992px) {
        .grid>div:nth-of-type(2) {
            display: block;
        }
    }
</style>
{% endblock %}

{% block body %}
<main class="container">
    <article class="grid">
        <div>
            <hgroup>
                <h1>登录</h1>
                <h2>欢迎使用 {{ settings.app_name }} v{{ settings.app_version }} 服务</h2>
            </hgroup>
            <form>
                <input type="text" id="username" placeholder="账户名称" aria-label="账户名称" autocomplete="nickname" required>
                <input type="password" id="password" placeholder="登录密码" aria-label="登录密码"
                    autocomplete="current-password" required>
                <fieldset>
                    <label for="remember">
                        <input type="checkbox" role="switch" id="remember" name="remember">
                        记住账户
                    </label>
                </fieldset>
                <button type="submit" class="contrast" onclick="event.preventDefault()">登录</button>
            </form>
        </div>
        <div></div>
    </article>
</main>

<script>
    $(document).ready(function () {
        $('button').click(function () {
            utilAjax(
                type = 'POST',
                url = '/token/',
                data = {
                    'username': $('#username').val(),
                    'password': $('#password').val(),
                },
                success = function (data, textStatus) {
                    Cookies.set('token', data.token_type + ' ' + data.access_token, { expires: 0.5, path: '/view/' });
                    Cookies.set('role', data.role_title, { expires: 0.5, path: '/view/' });
                    Cookies.set('permissions', data.role_permissions, { expires: 0.5, path: '/view/' });
                },
            );
        });
    });
</script>
{% endblock %}